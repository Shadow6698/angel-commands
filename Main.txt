if getgenv().CommandScriptLoaded then
    warn("Script j√° carregado!")
    return
end
getgenv().CommandScriptLoaded = true

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local prefix = ";"
local xrayParts = {}
local chatEnabled = true

-- Cache otimizado
local playerCache = {}
local lastCacheUpdate = 0

-- Fun√ß√£o para mostrar mensagem no centro da tela
local function ShowMessage(text, duration)
    duration = duration or 2
    local PlayerGui = LocalPlayer:FindFirstChild("PlayerGui")
    if not PlayerGui then return end

    local existing = PlayerGui:FindFirstChild("AdmMessageGui")
    if existing then existing:Destroy() end

    local gui = Instance.new("ScreenGui", PlayerGui)
    gui.Name = "AdmMessageGui"
    gui.ResetOnSpawn = false

    local label = Instance.new("TextLabel", gui)
    label.Size = UDim2.new(0.6, 0, 0.1, 0)
    label.Position = UDim2.new(0.2, 0, 0.45, 0)
    label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    label.BackgroundTransparency = 0.5
    label.BorderSizePixel = 0
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 0, 0)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 32
    label.TextStrokeTransparency = 0
    label.TextScaled = true
    label.ZIndex = 50

    game:GetService("Debris"):AddItem(gui, duration)
end

-- Fun√ß√£o otimizada para encontrar jogador
local function FindPlayer(name)
    name = name:lower()
    local currentTime = tick()
    
    if currentTime - lastCacheUpdate > 1 then
        playerCache = {}
        local allPlayers = Players:GetPlayers()
        for i = 1, #allPlayers do
            local player = allPlayers[i]
            playerCache[player] = {
                name = player.Name:lower(),
                display = player.DisplayName:lower()
            }
        end
        lastCacheUpdate = currentTime
    end
    
    for player, data in pairs(playerCache) do
        if data.name:find(name, 1, true) or data.display:find(name, 1, true) then
            return player
        end
    end
end

-- Fun√ß√£o para abrir GUI de comandos
local function OpenCmdGui()
    local PlayerGui = LocalPlayer:FindFirstChild("PlayerGui")
    if not PlayerGui then return end

    local existing = PlayerGui:FindFirstChild("CmdGui")
    if existing then existing:Destroy() end

    local gui = Instance.new("ScreenGui", PlayerGui)
    gui.Name = "CmdGui"
    gui.ResetOnSpawn = false

    local frame = Instance.new("Frame", gui)
    frame.Size = UDim2.new(0.4, 0, 0.6, 0)
    frame.Position = UDim2.new(0.3, 0, 0.2, 0)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.BackgroundTransparency = 0.2
    frame.BorderSizePixel = 0
    frame.ZIndex = 1

    local close = Instance.new("TextButton", frame)
    close.Size = UDim2.new(0, 35, 0, 35)
    close.Position = UDim2.new(1, -38, 0, 2)
    close.Text = "X"
    close.TextColor3 = Color3.new(1, 1, 1)
    close.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
    close.BorderSizePixel = 0
    close.Font = Enum.Font.SourceSansBold
    close.TextSize = 13
    close.ZIndex = 10
    close.MouseButton1Click:Connect(function()
        gui:Destroy()
    end)

    local chatToggle = Instance.new("TextButton", frame)
    chatToggle.Size = UDim2.new(0, 100, 0, 35)
    chatToggle.Position = UDim2.new(0, 5, 0, 2)
    chatToggle.Text = chatEnabled and "Chat: ON" or "Chat: OFF"
    chatToggle.TextColor3 = Color3.new(1, 1, 1)
    chatToggle.BackgroundColor3 = chatEnabled and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(170, 0, 0)
    chatToggle.BorderSizePixel = 0
    chatToggle.Font = Enum.Font.SourceSansBold
    chatToggle.TextSize = 12
    chatToggle.ZIndex = 10
    chatToggle.MouseButton1Click:Connect(function()
        chatEnabled = not chatEnabled
        chatToggle.Text = chatEnabled and "Chat: ON" or "Chat: OFF"
        chatToggle.BackgroundColor3 = chatEnabled and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(170, 0, 0)
        ShowMessage(chatEnabled and "Chat ativado!" or "Chat desativado!", 1)
    end)

    local scroll = Instance.new("ScrollingFrame", frame)
    scroll.Size = UDim2.new(1, -10, 1, -50)
    scroll.Position = UDim2.new(0, 5, 0, 45)
    scroll.CanvasSize = UDim2.new(0, 0, 4.5, 0)
    scroll.BackgroundTransparency = 1
    scroll.ScrollBarThickness = 8
    scroll.VerticalScrollBarInset = Enum.ScrollBarInset.Always
    scroll.BorderSizePixel = 0
    scroll.ZIndex = 1

    local label = Instance.new("TextLabel", scroll)
    label.Size = UDim2.new(1, -10, 0, 2000)
    label.Position = UDim2.new(0, 5, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 13
    label.TextWrapped = true
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Top
    label.ZIndex = 1
    label.Text = [[üî• COMANDOS üî•

;tp [apelido ou nick] ‚Üí Teleportar at√© local ou jogador
;tpsofa ‚Üí Sof√° secreto
;speed [n√∫mero] ‚Üí Alterar velocidade
;resetspeed ‚Üí Resetar velocidade (16)
;jumppower [n√∫mero] ‚Üí Alterar pulo
;resetjp ‚Üí Resetar pulo (50)
;speedsupreme ‚Üí Ativar Speed Supreme
;view [nick] ‚Üí Ver c√¢mera de algu√©m
;unview ‚Üí Voltar sua c√¢mera
;xray ‚Üí Ativar Xray
;unxray ‚Üí Desativar Xray
;coolkid ‚Üí Coolkid Hub
;portalgun ‚Üí Portal Gun
;void ‚Üí Void FE
;gravitygun ‚Üí Gravity Gun
;angelhub ‚Üí Angel Hub
;lanterna ‚Üí Lanterna
;cmd1 ‚Üí Nameless Admin
;hub1 ‚Üí Chaos Hub
;emotes ‚Üí Emotes Brookhaven RP
;gigante ‚Üí Modo Gigante
;bola ‚Üí Virar Bola
;chat ‚Üí Ativar/Desativar escuta do chat
;cmds ‚Üí Abrir este GUI

üè† TELEPORTS (apelidos)
;tp salao, ;tp sofa, ;tp doceria, ;tp jogos
;tp delegacia, ;tp hospital, ;tp banco, ;tp bombeiros
;tp cemiterio, ;tp escola, ;tp creche, ;tp caixas
;tp lanches, ;tp livraria, ;tp celulares, ;tp coffes
;tp veterinario, ;tp dentista, ;tp banco2, ;tp hotel
;tp hamburgueria, ;tp aeroporto, ;tp shopping
;tp ap1, ;tp ap2, ;tp igreja, ;tp praia1, praia2, praia3
;tp abandonada, maquinas, iate, cabana, drones
;tp fazenda1, fazenda2, pra√ßa, montanha, posto, loja, parque]]
end

-- Locais pr√©-definidos
local teleportAliases = {
    salao = Vector3.new(-76, 4, -123),
    sofa = Vector3.new(-82, 22, -128),
    doceria = Vector3.new(-125, 6, -120),
    jogos = Vector3.new(-172, 1, -126),
    delegacia = Vector3.new(-121, 4, 31),
    hospital = Vector3.new(-293, 4, 40),
    banco = Vector3.new(-358, 25, -143),
    bombeiros = Vector3.new(-469, 6, -122),
    cemiterio = Vector3.new(-486, 7, 56),
    escola = Vector3.new(-315, 6, 211),
    creche = Vector3.new(-157, 4, 125),
    caixas = Vector3.new(-162, 4, 268),
    lanches = Vector3.new(-169, 20, 291),
    livraria = Vector3.new(-129, 4, 259),
    celulares = Vector3.new(-127, 21, 253),
    coffes = Vector3.new(-96, 5, 250),
    veterinario = Vector3.new(-100, 22, 262),
    dentista = Vector3.new(-53, 20, 268),
    banco2 = Vector3.new(3, 4, 257),
    hotel = Vector3.new(199, 2, 182),
    hamburgueria = Vector3.new(156, 8, 39),
    aeroporto = Vector3.new(317, 7, 40),
    shopping = Vector3.new(165, 5, -158),
    ap1 = Vector3.new(-35, 20, -126),
    ap2 = Vector3.new(-34, 37, -136),
    igreja = Vector3.new(-64, 37, -192),
    praia1 = Vector3.new(70, 8, -1433),
    praia2 = Vector3.new(-218, 1, 760),
    praia3 = Vector3.new(15, 4, 1460),
    abandonada = Vector3.new(1044, 8, 54),
    maquinas = Vector3.new(235, 4, 813),
    iate = Vector3.new(-125, 33, 856),
    cabana = Vector3.new(-249, 6, 1078),
    drones = Vector3.new(-680, 252, 762),
    fazenda1 = Vector3.new(-851, 6, -57),
    fazenda2 = Vector3.new(-863, 6, -375),
    ["pra√ßa"] = Vector3.new(-13, 6, -17),
    montanha = Vector3.new(-580, 1, 1026),
    posto = Vector3.new(133, 2, -338),
    loja = Vector3.new(-39, 2, 255),
    parque = Vector3.new(180, 5, -173),
}

-- Fun√ß√µes XRAY otimizadas
local function enableXray()
    xrayParts = {}
    local parts = workspace:GetDescendants()
    
    for i = 1, #parts do
        local v = parts[i]
        if v:IsA("BasePart") and v.Transparency < 1 and v.CanCollide then
            xrayParts[#xrayParts + 1] = {part = v, transparency = v.Transparency}
            v.Transparency = 0.7
        end
    end
end

local function disableXray()
    for i = 1, #xrayParts do
        local v = xrayParts[i]
        if v.part and v.part.Parent then
            v.part.Transparency = v.transparency
        end
    end
    xrayParts = {}
end

-- Fun√ß√£o otimizada para obter componentes do personagem
local function GetCharacterComponents()
    local char = LocalPlayer.Character
    if char then
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        local root = char:FindFirstChild("HumanoidRootPart")
        if humanoid and root then
            return char, humanoid, root
        end
    end
    return nil, nil, nil
end

-- Sistema de execu√ß√£o de scripts externos sem delay
local scriptQueue = {}
local function ExecuteScript(url)
    local success, result = pcall(function()
        return game:HttpGet(url)
    end)
    if success then
        pcall(function()
            loadstring(result)()
        end)
    end
end

-- Fun√ß√£o de processamento de comandos otimizada
local function ProcessCommand(cmd, args, char, humanoid, root)
    if cmd == "tp" and args[2] then
        local place = args[2]
        local pos = teleportAliases[place]
        if pos then
            root.CFrame = CFrame.new(pos)
        else
            local target = FindPlayer(place)
            if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                root.CFrame = target.Character.HumanoidRootPart.CFrame
            end
        end
    elseif cmd == "tpsofa" then
        root.CFrame = CFrame.new(-83, 21, -131)
        humanoid:ChangeState(Enum.HumanoidStateType.Seated)
    elseif cmd == "speed" and args[2] then
        humanoid.WalkSpeed = tonumber(args[2]) or 16
    elseif cmd == "resetspeed" then
        humanoid.WalkSpeed = 16
    elseif cmd == "jumppower" and args[2] then
        humanoid.JumpPower = tonumber(args[2]) or 50
    elseif cmd == "resetjp" then
        humanoid.JumpPower = 50
    elseif cmd == "speedsupreme" then
        ExecuteScript("https://raw.githubusercontent.com/Shadow6698/Speed-2/main/Main.txt")
    elseif cmd == "view" and args[2] then
        local target = FindPlayer(args[2])
        if target and target.Character then
            local hum = target.Character:FindFirstChildOfClass("Humanoid")
            if hum then Camera.CameraSubject = hum end
        end
    elseif cmd == "unview" then
        Camera.CameraSubject = humanoid
    elseif cmd == "xray" then
        enableXray()
    elseif cmd == "unxray" then
        disableXray()
    elseif cmd == "coolkid" then
        ExecuteScript("https://raw.githubusercontent.com/Shadow6698/COOLKIDHUB/main/Main.txt")
    elseif cmd == "portalgun" then
        ExecuteScript("https://raw.githubusercontent.com/Shadow6698/Portal-gun-/main/Main.txt")
    elseif cmd == "void" then
        ExecuteScript("https://raw.githubusercontent.com/Shadow6698/Void-fe/main/main.txt")
    elseif cmd == "gravitygun" then
        ExecuteScript("https://scriptblox.com/raw/Universal-Script-Telekinesis-12332")
    elseif cmd == "angelhub" then
        ExecuteScript("https://raw.githubusercontent.com/Shadow6698/hubmystery/main/Main.txt")
    elseif cmd == "lanterna" then
        ExecuteScript("https://rawscripts.net/raw/Universal-Script-Flashlight-Script-40768")
    elseif cmd == "cmd1" then
        ExecuteScript("https://raw.githubusercontent.com/ltseverydayyou/Nameless-Admin/main/Source.lua")
    elseif cmd == "hub1" then
        ExecuteScript("https://raw.githubusercontent.com/Venom-devX/ChaosHub/main/loader.lua")
    elseif cmd == "emotes" then
        ExecuteScript("https://scriptblox.com/raw/Brookhaven-RP-all-emotes-6849")
    elseif cmd == "gigante" then
        ExecuteScript("https://rawscripts.net/raw/Brookhaven-RP-FE-BIG-AVATAR-43381")
    elseif cmd == "bola" then
        ExecuteScript("https://rawscripts.net/raw/Universal-Script-Fe-ball-rolL-9835")
    elseif cmd == "chat" then
        chatEnabled = not chatEnabled
        ShowMessage(chatEnabled and "Chat ativado!" or "Chat desativado!", 1)
    elseif cmd == "cmds" then
        OpenCmdGui()
    end
end

-- Fun√ß√£o principal de chat otimizada
local function OnChatted(msg)
    if not chatEnabled or not msg or msg:sub(1, #prefix):lower() ~= prefix then return end

    local args = {}
    for word in msg:sub(#prefix + 1):lower():gmatch("%S+") do
        args[#args + 1] = word
    end
    
    local cmd = args[1]
    if not cmd then return end

    local char, humanoid, root = GetCharacterComponents()
    if not humanoid or not root then return end

    ProcessCommand(cmd, args, char, humanoid, root)
end

-- Conectar evento de chat
LocalPlayer.Chatted:Connect(OnChatted)

-- Inicializa√ß√£o
RunService.Heartbeat:Connect(function()
    -- Atualiza√ß√£o cont√≠nua do cache se necess√°rio
end)

-- Mostrar GUI e mensagem inicial
OnChatted(prefix .. "cmds")
ShowMessage("EITA PORRA OLHA O ADM AI", 2)
