-- Serviços
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Variáveis globais
local prefix = ";"
local isGuiOpen = false
local bugConnections = {}
local viewingPlayer = nil
local gluedPlayer = nil
local glueConnection = nil

-- Função para encontrar player
local function findPlayer(name)
    name = name:lower()
    for _, player in pairs(Players:GetPlayers()) do
        if player.Name:lower():find(name) or player.DisplayName:lower():find(name) then
            return player
        end
    end
    return nil
end

-- Criar GUI principal
local function createGUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "CommandsGui"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = PlayerGui

    -- Botão para abrir GUI (menor)
    local OpenButton = Instance.new("TextButton")
    OpenButton.Name = "OpenButton"
    OpenButton.Size = UDim2.new(0, 50, 0, 25)
    OpenButton.Position = UDim2.new(0, 10, 1, -80)
    OpenButton.BackgroundColor3 = Color3.new(0, 0, 0)
    OpenButton.BorderColor3 = Color3.new(1, 1, 1)
    OpenButton.BorderSizePixel = 1
    OpenButton.Text = "CMD"
    OpenButton.TextColor3 = Color3.new(1, 1, 1)
    OpenButton.TextScaled = true
    OpenButton.Font = Enum.Font.SourceSansBold
    OpenButton.Active = true
    OpenButton.Parent = ScreenGui

    -- Frame principal dos comandos (menor)
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 220, 0, 280)
    MainFrame.Position = UDim2.new(0, 100, 0, 100) -- Posição inicial fixa
    MainFrame.BackgroundColor3 = Color3.new(0, 0, 0)
    MainFrame.BorderColor3 = Color3.new(1, 1, 1)
    MainFrame.BorderSizePixel = 2
    MainFrame.Visible = false
    MainFrame.Active = true
    MainFrame.Parent = ScreenGui

    -- Título com botão X (menor)
    local TitleFrame = Instance.new("Frame")
    TitleFrame.Size = UDim2.new(1, 0, 0, 25)
    TitleFrame.Position = UDim2.new(0, 0, 0, 0)
    TitleFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    TitleFrame.BorderColor3 = Color3.new(1, 1, 1)
    TitleFrame.BorderSizePixel = 1
    TitleFrame.Active = true
    TitleFrame.Parent = MainFrame

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -25, 1, 0)
    Title.Position = UDim2.new(0, 0, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "COMANDOS"
    Title.TextColor3 = Color3.new(1, 1, 1)
    Title.TextScaled = true
    Title.Font = Enum.Font.SourceSansBold
    Title.Parent = TitleFrame

    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 25, 1, 0)
    CloseButton.Position = UDim2.new(1, -25, 0, 0)
    CloseButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    CloseButton.BorderColor3 = Color3.new(1, 1, 1)
    CloseButton.BorderSizePixel = 1
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.new(1, 1, 1)
    CloseButton.TextScaled = true
    CloseButton.Font = Enum.Font.SourceSansBold
    CloseButton.Parent = TitleFrame

    -- Frame para prefix (menor)
    local PrefixFrame = Instance.new("Frame")
    PrefixFrame.Size = UDim2.new(1, -8, 0, 25)
    PrefixFrame.Position = UDim2.new(0, 4, 0, 30)
    PrefixFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    PrefixFrame.BorderColor3 = Color3.new(1, 1, 1)
    PrefixFrame.BorderSizePixel = 1
    PrefixFrame.Parent = MainFrame

    local PrefixLabel = Instance.new("TextLabel")
    PrefixLabel.Size = UDim2.new(0, 45, 1, 0)
    PrefixLabel.Position = UDim2.new(0, 0, 0, 0)
    PrefixLabel.BackgroundTransparency = 1
    PrefixLabel.Text = "Prefix:"
    PrefixLabel.TextColor3 = Color3.new(1, 1, 1)
    PrefixLabel.TextScaled = true
    PrefixLabel.Font = Enum.Font.SourceSans
    PrefixLabel.Parent = PrefixFrame

    local PrefixBox = Instance.new("TextBox")
    PrefixBox.Size = UDim2.new(1, -48, 1, -4)
    PrefixBox.Position = UDim2.new(0, 46, 0, 2)
    PrefixBox.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    PrefixBox.BorderColor3 = Color3.new(1, 1, 1)
    PrefixBox.BorderSizePixel = 1
    PrefixBox.Text = prefix
    PrefixBox.TextColor3 = Color3.new(1, 1, 1)
    PrefixBox.TextScaled = true
    PrefixBox.Font = Enum.Font.SourceSans
    PrefixBox.Parent = PrefixFrame

    -- TextBox para comandos (menor)
    local CommandBox = Instance.new("TextBox")
    CommandBox.Size = UDim2.new(1, -8, 0, 25)
    CommandBox.Position = UDim2.new(0, 4, 0, 60)
    CommandBox.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    CommandBox.BorderColor3 = Color3.new(1, 1, 1)
    CommandBox.BorderSizePixel = 1
    CommandBox.PlaceholderText = "Digite o comando..."
    CommandBox.Text = ""
    CommandBox.TextColor3 = Color3.new(1, 1, 1)
    CommandBox.TextScaled = true
    CommandBox.Font = Enum.Font.SourceSans
    CommandBox.Parent = MainFrame

    -- ScrollFrame para lista de comandos (menor)
    local ScrollFrame = Instance.new("ScrollingFrame")
    ScrollFrame.Size = UDim2.new(1, -8, 1, -95)
    ScrollFrame.Position = UDim2.new(0, 4, 0, 90)
    ScrollFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    ScrollFrame.BorderColor3 = Color3.new(1, 1, 1)
    ScrollFrame.BorderSizePixel = 1
    ScrollFrame.ScrollBarThickness = 6
    ScrollFrame.Parent = MainFrame

    local UIListLayout = Instance.new("UIListLayout")
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.Padding = UDim.new(0, 2)
    UIListLayout.Parent = ScrollFrame

    -- Lista de comandos (mais compacta)
    local commands = {
        "tp [nick] - Teleportar",
        "view [nick] - Ver câmera",
        "unview - Parar view",
        "glue [nick] - Grudar",
        "unglue - Desgrudar",
        "bug [nick] - Bug player",
        "unbug [nick] - Remove bug"
    }

    -- Criar labels dos comandos (menores)
    for i, command in ipairs(commands) do
        local CommandLabel = Instance.new("TextLabel")
        CommandLabel.Size = UDim2.new(1, 0, 0, 20)
        CommandLabel.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        CommandLabel.BorderColor3 = Color3.new(1, 1, 1)
        CommandLabel.BorderSizePixel = 1
        CommandLabel.Text = command
        CommandLabel.TextColor3 = Color3.new(1, 1, 1)
        CommandLabel.TextXAlignment = Enum.TextXAlignment.Left
        CommandLabel.TextScaled = true
        CommandLabel.Font = Enum.Font.SourceSans
        CommandLabel.Parent = ScrollFrame
    end

    -- Ajustar tamanho do scroll
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, #commands * 22)

    -- Animações e eventos
    local function openGui()
        isGuiOpen = true
        MainFrame.Visible = true
        
        -- Posicionar no centro da tela atual
        local viewportSize = workspace.CurrentCamera.ViewportSize
        local centerX = (viewportSize.X / 2) - 110
        local centerY = (viewportSize.Y / 2) - 140
        
        -- Animação de entrada suave (botão CMD permanece visível)
        MainFrame.Size = UDim2.new(0, 0, 0, 0)
        MainFrame.Position = UDim2.new(0, viewportSize.X / 2, 0, viewportSize.Y / 2)
        
        local tween = TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 220, 0, 280),
            Position = UDim2.new(0, centerX, 0, centerY)
        })
        tween:Play()
    end

    local function closeGui()
        isGuiOpen = false
        
        local tween = TweenService:Create(MainFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        })
        tween:Play()
        
        tween.Completed:Connect(function()
            MainFrame.Visible = false
        end)
    end

    OpenButton.MouseButton1Click:Connect(openGui)
    CloseButton.MouseButton1Click:Connect(closeGui)

    -- Sistema de arrastar para mobile (OpenButton)
    local dragging = false
    local dragStart = nil
    local startPos = nil
    local isDragging = false

    OpenButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            isDragging = false
            dragStart = input.Position
            startPos = OpenButton.Position
        end
    end)

    OpenButton.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            if dragging and dragStart and not isDragging then
                local dragDistance = (input.Position - dragStart).Magnitude
                if dragDistance < 10 then -- Aumentei para 10 pixels
                    openGui()
                end
            end
            dragging = false
            isDragging = false
        end
    end)

    -- Sistema de arrastar para mobile (MainFrame pela barra de título)
    local frameDragging = false
    local frameDragStart = nil
    local frameStartPos = nil

    TitleFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            frameDragging = true
            frameDragStart = input.Position
            frameStartPos = MainFrame.Position
        end
    end)

    TitleFrame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            frameDragging = false
        end
    end)

    -- Movement handling
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            -- Arrastar botão
            if dragging and dragStart and startPos then
                local delta = input.Position - dragStart
                if delta.Magnitude > 5 then -- Marca como arrastando se moveu mais de 5 pixels
                    isDragging = true
                end
                
                -- Obter tamanho atual da tela
                local viewportSize = workspace.CurrentCamera.ViewportSize
                local newX = math.clamp(startPos.X.Offset + delta.X, 0, viewportSize.X - 50)
                local newY = math.clamp(startPos.Y.Offset + delta.Y, 0, viewportSize.Y - 25)
                OpenButton.Position = UDim2.new(0, newX, 0, newY)
            end
            
            -- Arrastar frame principal
            if frameDragging and frameDragStart and frameStartPos then
                local delta = input.Position - frameDragStart
                -- Obter tamanho atual da tela
                local viewportSize = workspace.CurrentCamera.ViewportSize
                local newX = math.clamp(frameStartPos.X.Offset + delta.X, 0, viewportSize.X - 220)
                local newY = math.clamp(frameStartPos.Y.Offset + delta.Y, 0, viewportSize.Y - 280)
                MainFrame.Position = UDim2.new(0, newX, 0, newY)
            end
        end
    end)

    -- Atualizar prefix
    PrefixBox.FocusLost:Connect(function()
        if PrefixBox.Text ~= "" then
            prefix = PrefixBox.Text
        else
            PrefixBox.Text = prefix
        end
    end)

    -- Processar comando da TextBox
    CommandBox.FocusLost:Connect(function(enterPressed)
        if enterPressed and CommandBox.Text ~= "" then
            processCommand(CommandBox.Text)
            CommandBox.Text = ""
        end
    end)
end

-- Função para processar comandos
function processCommand(text)
    local args = text:split(" ")
    local command = args[1]:lower()
    
    if command == "tp" and args[2] then
        local targetPlayer = findPlayer(args[2])
        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                LocalPlayer.Character.HumanoidRootPart.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(5, 0, 0)
            end
        end
        
    elseif command == "view" and args[2] then
        local targetPlayer = findPlayer(args[2])
        if targetPlayer then
            viewingPlayer = targetPlayer
            workspace.CurrentCamera.CameraSubject = targetPlayer.Character and targetPlayer.Character:FindFirstChild("Humanoid")
        end
        
    elseif command == "unview" then
        viewingPlayer = nil
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            workspace.CurrentCamera.CameraSubject = LocalPlayer.Character.Humanoid
        end
        
    elseif command == "glue" and args[2] then
        local targetPlayer = findPlayer(args[2])
        if targetPlayer then
            gluedPlayer = targetPlayer
            if glueConnection then
                glueConnection:Disconnect()
            end
            glueConnection = RunService.Heartbeat:Connect(function()
                if gluedPlayer and gluedPlayer.Character and gluedPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        LocalPlayer.Character.HumanoidRootPart.CFrame = gluedPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, 3)
                    end
                end
            end)
        end
        
    elseif command == "unglue" then
        gluedPlayer = nil
        if glueConnection then
            glueConnection:Disconnect()
            glueConnection = nil
        end
        
    elseif command == "bug" and args[2] then
        local targetPlayer = findPlayer(args[2])
        if targetPlayer then
            local Remote = ReplicatedStorage:FindFirstChild("RE") and ReplicatedStorage.RE:FindFirstChild("1Gu1n")
            if Remote then
                bugConnections[targetPlayer.UserId] = RunService.Stepped:Connect(function()
                    if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        local crazyVector = Vector3.new(
                            math.random(1e14, 1e15),
                            math.random(1e14, 1e15),
                            math.random(1e14, 1e15)
                        )
                        local args = {
                            [1] = targetPlayer.Character.HumanoidRootPart,
                            [2] = targetPlayer.Character.HumanoidRootPart,
                            [3] = crazyVector,
                            [4] = targetPlayer.Character.HumanoidRootPart.Position,
                            [5] = LocalPlayer.Backpack:FindFirstChild("Assault") and LocalPlayer.Backpack.Assault.GunScript_Local:FindFirstChild("MuzzleEffect"),
                            [6] = LocalPlayer.Backpack:FindFirstChild("Assault") and LocalPlayer.Backpack.Assault.GunScript_Local:FindFirstChild("HitEffect"),
                            [7] = 0,
                            [8] = 0,
                            [9] = { [1] = false },
                            [10] = {
                                [1] = 25,
                                [2] = Vector3.new(100, 100, 100),
                                [3] = BrickColor.new(29),
                                [4] = 0.25,
                                [5] = Enum.Material.SmoothPlastic,
                                [6] = 0.25
                            },
                            [11] = true,
                            [12] = false
                        }
                        Remote:FireServer(unpack(args))
                    end
                end)
            end
        end
        
    elseif command == "unbug" and args[2] then
        local targetPlayer = findPlayer(args[2])
        if targetPlayer and bugConnections[targetPlayer.UserId] then
            bugConnections[targetPlayer.UserId]:Disconnect()
            bugConnections[targetPlayer.UserId] = nil
        end
    end
end

-- Detectar comandos no chat
LocalPlayer.Chatted:Connect(function(message)
    if message:sub(1, #prefix) == prefix then
        local command = message:sub(#prefix + 1)
        processCommand(command)
    end
end)

-- Criar GUI quando o script rodar
createGUI()

print("Sistema de comandos mobile carregado! Prefix atual: " .. prefix)
